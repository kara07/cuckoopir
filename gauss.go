package cuckoopir

import _ "fmt"

// std_dev = 1
var cdf_table_1 = [...]float64{
	0.5, 0.4578333617716143, 0.043936933623407434, 0.0008838263069350515, 3.7266531720786777e-06, 3.2937141103060925e-09, 6.101936677605367e-13, 2.369541747340193e-17, 1.9287498479639315e-22, 3.290806277274959e-28, 1.176910943921689e-34, 8.822664357494803e-42, 1.3863432936412101e-49, 4.56621846799426e-58, 3.152517155145115e-67, 4.562187213172471e-77, 1.3838965267367769e-87, 8.799317893789583e-99, 1.1727603332849226e-110, 3.276305574229551e-123, 1.9185556689348942e-136, 2.3549369378030894e-150, 6.058973183257031e-165, 3.2676358406799337e-180, 3.693883068487676e-196, 8.75281014057458e-213, 4.347371408870115e-230, 4.5260656967793574e-248, 9.877108721521013e-267, 4.518077612006297e-286, 4.332039538514894e-306,
}

// std_dev = 1.4
var cdf_table_1p4 = [...]float64{
	0.5, 0.7748374288832492, 0.36044778859782095, 0.10066889977289777, 0.016879884148789895, 0.0016992793655526556, 0.00010270256461965522, 3.726653172078664e-06, 8.118538349144025e-08, 1.0618371101937899e-09, 8.337947094201132e-12, 3.930805485965844e-14, 1.1125643881294098e-16, 1.8905577075970254e-19, 1.9287498479639042e-22, 1.1813621547958505e-25, 4.3442157510562815e-29, 9.5909339579376e-33, 1.2712518495623039e-36, 1.0116341413217376e-40, 4.8332197389760766e-45, 1.3863432936411508e-49, 2.387405631638782e-54, 2.468327744441326e-59, 1.532147646101949e-64, 5.7097828854386974e-70, 1.2774966013702942e-75, 1.7160150602824359e-81, 1.3838965267366983e-87, 6.700501771823613e-94, 1.9477455289096053e-100, 3.3992122917150386e-107, 3.561603288439938e-114, 2.240443423733423e-121, 8.461426805738796e-129, 1.918555668934676e-136, 2.611718655134353e-144, 2.1345167139005184e-152, 1.047355001948306e-160, 3.085385578149996e-169, 5.456902094732212e-178, 5.794341150881118e-187, 3.6938830684870465e-196, 1.4137851263887765e-205, 3.248664449642046e-215, 4.481748545431012e-225, 3.7120284760854286e-235, 1.845849527957194e-245, 5.510645492951228e-256, 9.877108721518768e-267, 1.062865665671273e-277, 6.866700484302959e-289, 2.6634160571032185e-300, 6.20227624573e-312, 1e-323,
}

// std_dev = 2.3
var cdf_table_2p3 = [...]float64{
	0.5, 0.9098113957113441, 0.6851812798268945, 0.4271322367708993, 0.22040526037377564, 0.09414219185952324, 0.03328506427652355, 0.009741307187283428, 0.0023598686025640054, 0.0004732178846859423, 7.854837812049273e-05, 1.0792350434825107e-05, 1.2274324475447827e-06, 1.1555318097136519e-07, 9.00469392117463e-09, 5.808429864220314e-10, 3.101353625079719e-11, 1.3707131266768628e-12, 5.014695874461113e-14, 1.5186069101714534e-15, 3.806702070733484e-17, 7.898691455045158e-19, 1.3566385536214447e-20, 1.9287498479639042e-22, 2.2698146734046046e-24, 2.2110961991837677e-26, 1.782902612300279e-28, 1.190009282367331e-30, 6.574698185856304e-33, 3.0067965118005496e-35, 1.138243027851341e-37, 3.566717431164897e-40, 9.251350906022547e-43, 1.986297740267665e-45, 3.530094140648472e-48, 5.1931512380124834e-51, 6.323803960631115e-54, 6.374242334543926e-57, 5.318405990297201e-60, 3.673137178040447e-63, 2.0998852035304959e-66, 9.937032340980185e-70, 3.892428086329314e-73, 1.2620810223176042e-76, 3.3873230670119025e-80, 7.525385413022319e-84, 1.3838965267366983e-87, 2.106595906274879e-91, 2.6543708349555787e-95, 2.768501112055663e-99, 2.390179692206781e-103, 1.7081230233503027e-107, 1.0104398953920039e-111, 4.947713782286804e-116, 2.0054017797914874e-120, 6.728232153562087e-125, 1.8685438092676983e-129, 4.295446810006554e-134, 8.173652144289684e-139, 1.2874391182406464e-143, 1.6785720799076047e-148, 1.8115738116476056e-153, 1.61835881237667e-158, 1.1967304585733165e-163, 7.325219058395935e-169, 3.71148434593967e-174, 1.5566013188933827e-179, 5.403932298524003e-185, 1.5529059332277372e-190, 3.6938830684870465e-196, 7.273172403730769e-202, 1.1854066667181644e-207, 1.599239812915397e-213, 1.7859223199225568e-219, 1.6508753444190005e-225, 1.2631901844843222e-231, 8.000662448410906e-238, 4.194555040221232e-244, 1.8203235669132333e-250, 6.5390405483671176e-257, 1.9443847828266936e-263, 4.785784525390454e-270, 9.7504983488063e-277, 1.6443839512737676e-283, 2.2955269213235963e-290, 2.652554377643661e-297, 2.537166365915238e-304, 2.008798334936e-311, 1.316517e-318,
}

// std_dev = 3
var cdf_table_3 = [...]float64{
	0.5, 0.9459594689067654, 0.8007374029168081, 0.6065306597126334, 0.41111229050718745, 0.24935220877729622, 0.1353352832366127, 0.06572852861653047, 0.028565500784550377, 0.011108996538242306, 0.0038659201394728076, 0.001203859994828203, 0.00033546262790251185, 8.364834722972752e-05, 1.866446911352057e-05, 3.726653172078671e-06, 6.658361469857315e-07, 1.0645371411076024e-07, 1.522997974471263e-08, 1.9497677860172307e-09, 2.233631436203166e-10, 2.289734845645553e-11, 2.1004092927322525e-12, 1.724120939035512e-13, 1.2664165549094176e-14, 8.323969676981166e-16, 4.8958652645860795e-17, 2.576757109154981e-18, 1.213563668125796e-19, 5.114423731803711e-21, 1.9287498479639178e-22, 6.5087885154679006e-24, 1.9654838241636744e-25, 5.311092249679095e-27, 1.2842313672676012e-28, 2.7787390183170706e-30, 5.380186160021138e-32, 9.321630933398905e-34, 1.4452120129541253e-35, 2.005008781961654e-37, 2.4891212533275478e-39, 2.765163938648108e-41, 2.7487850079102147e-43, 2.4451512024555155e-45, 1.9463266273143046e-47, 1.3863432936411706e-49, 8.836309217492346e-52, 5.039832258351181e-54, 2.572209372642415e-56, 1.174739598533454e-58, 4.800892238919265e-61, 1.7556880978548265e-63, 5.745367715230481e-66, 1.6824158527128005e-68, 4.408531331463226e-71, 1.0337120265673203e-73, 2.1689536131352462e-76, 4.0723586257611754e-79, 6.842059184017448e-82, 1.0286619937923979e-84, 1.3838965267367376e-87, 1.6660176655200467e-90, 1.7947362817304938e-93, 1.73008220968259e-96, 1.4923747614760575e-99, 1.1519512724636078e-102, 7.9567438919514e-106, 4.917922806045514e-109, 2.720026237617272e-112, 1.3461998461573202e-115, 5.961987174638857e-119, 2.3627490426729678e-122, 8.378942533819369e-126, 2.6589237633496464e-129, 7.550359258120274e-133, 1.918555668934785e-136, 4.362407702468618e-140, 8.876119801807612e-144, 1.616088413820251e-147, 2.633007739358096e-151, 3.838700348963704e-155, 5.007965706612792e-159, 5.84633285607385e-163, 6.1073215636491134e-167, 5.709040105864101e-171, 4.7755176912374886e-175, 3.5745623785021315e-179, 2.394254760948756e-183, 1.4350363324396062e-187, 7.696627910991492e-192, 3.693883068487256e-196, 1.5863932499301823e-200, 6.096542709417836e-205, 2.0965317582885168e-209, 6.45155386977958e-214, 1.776528863623507e-218, 4.377491037053051e-223, 9.652133513733217e-228, 1.904436223412861e-232, 3.3624404663242076e-237, 5.312364080113972e-242, 7.510452727943757e-247, 9.501440650208043e-252, 1.07561750249298e-256, 1.0896105976579289e-261, 9.87710872151989e-267, 8.011861027895e-272, 5.815432755751544e-277, 3.7772499723621244e-282, 2.1954041086169845e-287, 1.1418216572867824e-292, 5.314068364454539e-298, 2.2131000901411116e-303, 8.247456471051965e-309, 2.7503253126e-314, 8.207e-320,
}

// std_dev = 6.4
// var cdf_table_6p4 = [...]float64{
// 	0.5, 0.987867, 0.952345, 0.895957, 0.822578, 0.736994, 0.644389, 0.549831, 0.457833, 0.372034,
// 	0.295023, 0.22831, 0.172422, 0.127074, 0.0913938, 0.0641467, 0.0439369, 0.0293685, 0.0191572,
// 	0.0121949, 0.00757568, 0.00459264, 0.00271706, 0.00156868, 0.000883826, 0.000485955, 0.000260749,
// 	0.000136536, 6.97696e-05, 3.47923e-05, 1.69316e-05, 8.041e-06, 3.72665e-06, 1.68549e-06,
// 	7.43923e-07, 3.20426e-07, 1.34687e-07, 5.52484e-08, 2.21163e-08, 8.63973e-09,
// 	3.29371e-09, 1.22537e-09, 4.44886e-10, 1.57625e-10, 5.45004e-11, 1.83896e-11,
// 	6.05535e-12, 1.94583e-12, 6.10194e-13, 1.86736e-13, 5.57679e-14, 1.62532e-14,
// 	4.62263e-15, 1.28303e-15, 3.47522e-16, 9.18597e-17, 2.36954e-17, 5.96487e-18,
// 	1.46533e-18, 3.5129e-19, 8.21851e-20, 1.87637e-20, 4.18062e-21, 9.08991e-22, 1.92875e-22,
// 	3.99383e-23, 8.07049e-24, 1.5915e-24, 3.06275e-25, 5.75194e-26, 1.05418e-26, 1.88542e-27,
// 	3.29081e-28, 5.60522e-29, 9.31708e-30, 1.51135e-30, 2.39247e-31, 3.69594e-32,
// 	5.57187e-33, 8.19735e-34, 1.17691e-34, 1.64896e-35, 2.25463e-36, 3.00841e-37,
// 	3.91737e-38, 4.97795e-39, 6.1731e-40, 7.47055e-41, 8.82266e-42, 1.01682e-42, 1.14363e-43,
// 	1.25523e-44, 1.34449e-45, 1.40537e-46, 1.43357e-47, 1.42708e-48, 1.38634e-49,
// 	1.31429e-50, 1.21593e-51, 1.0978e-52, 9.67246e-54, 8.31661e-55, 6.97835e-56, 5.71421e-57,
// 	4.56622e-58, 3.56086e-59, 2.70987e-60, 2.01252e-61, 1.45858e-62, 1.03161e-63,
// 	7.12032e-65, 4.79601e-66, 3.15252e-67, 2.02224e-68, 1.26591e-69, 7.73344e-71, 4.6104e-72,
// 	2.68226e-73, 1.52287e-74, 8.4376e-76, 4.56219e-77, 2.40727e-78, 1.23958e-79, 6.22901e-81,
// 	3.05465e-82, 1.46185e-83, 6.82713e-85, 3.11152e-86, 1.3839e-87,
// }

var cdf_table_6p4 = [...]float64{
	0.5, 0.9878671723140003, 0.9523447998951764, 0.8959566209925682, 0.8225775623986646, 0.736993813311011, 0.6443887248251954, 0.5498308842335518, 0.4578333617716143, 0.3720341859374525, 0.2950226561744429, 0.22831003268047267, 0.17242162389375287, 0.12707367009073386, 0.09139375535604728, 0.06414673848332596, 0.043936933623407434, 0.029368516926505713, 0.019157171837129155, 0.012194889831651208, 0.0075756774442599425, 0.0045926375916388726, 0.002717064729323586, 0.0015686819551156451, 0.0008838263069350515, 0.00048595499985097386, 0.0002607487846688273, 0.00013653551674503917, 6.976957719599722e-05, 3.479234101263891e-05, 1.6931612436130023e-05, 8.041000588185211e-06, 3.7266531720786777e-06, 1.6854852873722956e-06, 7.439231317435057e-07, 3.2042638298308737e-07, 1.3468696888087153e-07, 5.524843729234549e-08, 2.2116251758271562e-08, 8.639729769913123e-09, 3.2937141103060925e-09, 1.2253742477384276e-09, 4.448859650129368e-10, 1.5762524280470742e-10, 5.4500431328841584e-11, 1.838955489497277e-11, 6.055354917708228e-12, 1.94583090172743e-12, 6.101936677605367e-13, 1.867357215750939e-13, 5.5767890791115665e-14, 1.6253172389003213e-14, 4.62263040548374e-15, 1.2830314698448336e-15, 3.475222003601891e-16, 9.185967516020678e-17, 2.369541747340193e-17, 5.9648692909415595e-18, 1.4653271804402526e-18, 3.512896762713697e-19, 8.218513554096799e-20, 1.8763690981207474e-20, 4.1806169355170656e-21, 9.089910067890163e-22, 1.9287498479639315e-22, 3.993827752956329e-23, 8.070489255152528e-24, 1.5915031557361074e-24, 3.0627549606146605e-25, 5.75193682139395e-26, 1.054175866903886e-26, 1.8854244719142572e-27, 3.290806277274959e-28, 5.605219210529805e-29, 9.317083633057163e-30, 1.511348061581414e-30, 2.3924677935073458e-31, 3.6959391672236534e-32, 5.571865648920334e-33, 8.197351633240025e-34, 1.176910943921689e-34, 1.648962370190244e-35, 2.254628518970565e-36, 3.0084053656654662e-37, 3.917372050763991e-38, 4.977948436014447e-39, 6.173096616540149e-40, 7.470554909847627e-41, 8.822664357494803e-42, 1.0168192518736734e-42, 1.143628238437708e-43, 1.2552293570253407e-44, 1.3444925891435336e-45, 1.4053705384872047e-46, 1.4335748871056266e-47, 1.427075767105878e-48, 1.3863432936412101e-49, 1.3142913439783726e-50, 1.2159329201795724e-51, 1.0978037076136135e-52, 9.672458544585328e-54, 8.316606785993381e-55, 6.978347093668317e-56, 5.714208368249234e-57, 4.56621846799426e-58, 3.5608559643911393e-59, 2.7098748544152925e-60, 2.0125244743147372e-61, 1.458579862799102e-62, 1.0316119484213045e-63, 7.12032178989795e-65, 4.796008964652135e-66, 3.152517155145115e-67, 2.022236935152923e-68, 1.2659126083363215e-69, 7.733436429585977e-71, 4.610398037957091e-72, 2.6822634455645844e-73, 1.5228654986099342e-74, 8.437596863890068e-76, 4.562187213172471e-77, 2.407268548287382e-78, 1.2395757965481975e-79, 6.229005886381123e-81, 3.0546503229871403e-82, 1.4618451472085412e-83, 6.827132725391541e-85, 3.111518797284251e-86, 1.3838965267367769e-87, 6.006644332167649e-89, 2.544235582728249e-90, 1.0516708458753838e-91, 4.242281221273962e-93, 1.669998887382341e-94, 6.4154927188958615e-96, 2.405143307673002e-97, 8.799317893789583e-99, 3.141623699920693e-100, 1.0946024821954803e-101, 3.721823726222261e-103, 1.2349582593119657e-104, 3.9989489980958514e-106, 1.2636783903845782e-107, 3.8969457492447972e-109, 1.1727603332849226e-110, 3.4442231698812704e-112, 9.8712103619924e-114, 2.7608743224642815e-115, 7.535637097807311e-117, 2.007198948182057e-118, 5.217446126023544e-120, 1.3234960008450747e-121, 3.276305574229551e-123, 7.914860694636062e-125, 1.8659468007711806e-126, 4.292915569306612e-128, 9.638346694809147e-130, 2.1117857170574474e-131, 4.515379530322157e-133, 9.421841171560144e-135, 1.9185556689348942e-136, 3.8125025162311245e-138, 7.393379178887386e-140, 1.3991778734895423e-141, 2.5840444767805284e-143, 4.6571920534541635e-145, 8.191160173223455e-147, 1.4059303182301464e-148, 2.3549369378030894e-150, 3.849389652234341e-152, 6.140469445038841e-154, 9.558910210245145e-156, 1.4521527347105887e-157, 2.1528477590474314e-159, 3.114665762241261e-161, 4.3975084834449875e-163, 6.058973183257031e-165, 8.14682677566085e-167, 1.0689934427279558e-168, 1.3688589748439686e-170, 1.7105646060189028e-172, 2.086014692032236e-174, 2.482517687912519e-176, 2.883131476544643e-178, 3.2676358406799337e-180, 3.614098307544803e-182, 3.9008870886712544e-184, 4.108884233601749e-186, 4.223587911780234e-188, 4.2367835625114675e-190, 4.147516535179878e-192, 3.962206272313719e-194, 3.693883068487676e-196, 3.360673437001407e-198, 2.9837785699558256e-200, 2.5852585015165543e-202, 2.1859411559259695e-204, 1.80372392593167e-206, 1.4524419128072087e-208, 1.1413650946717942e-210, 8.75281014057458e-213, 6.550395715942216e-215, 4.7839284226130575e-217, 3.409564547449592e-219, 2.371429769894392e-221, 1.6096028256537e-223, 1.0661646808482826e-225, 6.891709527114789e-228, 4.347371408870115e-230, 2.6762312193395655e-232, 1.6077467034309273e-234, 9.425594029390021e-237, 5.39258426545879e-239, 3.010802427117908e-241, 1.6404563618600565e-243, 8.722564993391357e-246, 4.5260656967793574e-248, 2.2918943834270318e-250, 1.1325710452269302e-252, 5.461770104780798e-255, 2.570386815553455e-257, 1.1804855114163721e-259, 5.290782943918542e-262, 2.3140691674347954e-264, 9.877108721521013e-267, 4.11415301450867e-269, 1.672353768623132e-271, 6.633961911620414e-274, 2.568117567089613e-276, 9.701836175990276e-279, 3.57676230211917e-281, 1.286836377941388e-283, 4.518077612006297e-286, 1.5480363410698216e-288, 5.176136539861041e-291, 1.6889912648183316e-293, 5.378314452199267e-296, 1.6713295225434731e-298, 5.0684490636938594e-301, 1.499979056902893e-303, 4.332039538514894e-306, 1.220946784836359e-308, 3.35813512022e-311, 9.01356729e-314, 2.36098024e-316, 6.0351e-319, 1.507e-321, 5e-324,
}

// The function below is modeled on Martin Albrecht's discrete-Gaussian
// sampler included in his dgs library:
// https://github.com/malb/dgs
func GaussSample() int64 {
	mrand := MathRand()

	// fmt.Println("len(cdf_table_1p4):", len(cdf_table_1p4))
	// fmt.Println("len(cdf_table_2p3):", len(cdf_table_2p3))
	// fmt.Println("len(cdf_table_3):", len(cdf_table_3))
	// fmt.Println("len(cdf_table_6p4):", len(cdf_table_6p4))
	

	cdf_table := cdf_table_1p4
	
	var x int64
	var y float64
	for {
		x = int64(mrand.Intn(len(cdf_table)))
		y = mrand.Float64()

		if y < cdf_table[x] {

			break
		}
	}

	if mrand.Uint64()%2 == 0 {
		x = -x
	}

	return x
}
