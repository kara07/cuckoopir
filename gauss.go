package cuckoopir

import _ "fmt"

// std_dev = 1
var cdf_table_1 = [...]float64{
	0.5, 0.4578333617716143, 0.043936933623407434, 0.0008838263069350515, 3.7266531720786777e-06, 3.2937141103060925e-09, 6.101936677605367e-13, 2.369541747340193e-17, 1.9287498479639315e-22, 3.290806277274959e-28, 1.176910943921689e-34, 8.822664357494803e-42, 1.3863432936412101e-49, 4.56621846799426e-58, 3.152517155145115e-67, 4.562187213172471e-77, 1.3838965267367769e-87, 8.799317893789583e-99, 1.1727603332849226e-110, 3.276305574229551e-123, 1.9185556689348942e-136, 2.3549369378030894e-150, 6.058973183257031e-165, 3.2676358406799337e-180, 3.693883068487676e-196, 8.75281014057458e-213, 4.347371408870115e-230, 4.5260656967793574e-248, 9.877108721521013e-267, 4.518077612006297e-286, 4.332039538514894e-306,
}

// std_dev = 1.4
var cdf_table_1p4 = [...]float64{
	0.5, 0.7748374288832492, 0.36044778859782095, 0.10066889977289777, 0.016879884148789895, 0.0016992793655526556, 0.00010270256461965522, 3.726653172078664e-06, 8.118538349144025e-08, 1.0618371101937899e-09, 8.337947094201132e-12, 3.930805485965844e-14, 1.1125643881294098e-16, 1.8905577075970254e-19, 1.9287498479639042e-22, 1.1813621547958505e-25, 4.3442157510562815e-29, 9.5909339579376e-33, 1.2712518495623039e-36, 1.0116341413217376e-40, 4.8332197389760766e-45, 1.3863432936411508e-49, 2.387405631638782e-54, 2.468327744441326e-59, 1.532147646101949e-64, 5.7097828854386974e-70, 1.2774966013702942e-75, 1.7160150602824359e-81, 1.3838965267366983e-87, 6.700501771823613e-94, 1.9477455289096053e-100, 3.3992122917150386e-107, 3.561603288439938e-114, 2.240443423733423e-121, 8.461426805738796e-129, 1.918555668934676e-136, 2.611718655134353e-144, 2.1345167139005184e-152, 1.047355001948306e-160, 3.085385578149996e-169, 5.456902094732212e-178, 5.794341150881118e-187, 3.6938830684870465e-196, 1.4137851263887765e-205, 3.248664449642046e-215, 4.481748545431012e-225, 3.7120284760854286e-235, 1.845849527957194e-245, 5.510645492951228e-256, 9.877108721518768e-267, 1.062865665671273e-277, 6.866700484302959e-289, 2.6634160571032185e-300, 6.20227624573e-312, 1e-323,
}

// std_dev = 2.3
var cdf_table_2p3 = [...]float64{
	0.5, 0.9098113957113441, 0.6851812798268945, 0.4271322367708993, 0.22040526037377564, 0.09414219185952324, 0.03328506427652355, 0.009741307187283428, 0.0023598686025640054, 0.0004732178846859423, 7.854837812049273e-05, 1.0792350434825107e-05, 1.2274324475447827e-06, 1.1555318097136519e-07, 9.00469392117463e-09, 5.808429864220314e-10, 3.101353625079719e-11, 1.3707131266768628e-12, 5.014695874461113e-14, 1.5186069101714534e-15, 3.806702070733484e-17, 7.898691455045158e-19, 1.3566385536214447e-20, 1.9287498479639042e-22, 2.2698146734046046e-24, 2.2110961991837677e-26, 1.782902612300279e-28, 1.190009282367331e-30, 6.574698185856304e-33, 3.0067965118005496e-35, 1.138243027851341e-37, 3.566717431164897e-40, 9.251350906022547e-43, 1.986297740267665e-45, 3.530094140648472e-48, 5.1931512380124834e-51, 6.323803960631115e-54, 6.374242334543926e-57, 5.318405990297201e-60, 3.673137178040447e-63, 2.0998852035304959e-66, 9.937032340980185e-70, 3.892428086329314e-73, 1.2620810223176042e-76, 3.3873230670119025e-80, 7.525385413022319e-84, 1.3838965267366983e-87, 2.106595906274879e-91, 2.6543708349555787e-95, 2.768501112055663e-99, 2.390179692206781e-103, 1.7081230233503027e-107, 1.0104398953920039e-111, 4.947713782286804e-116, 2.0054017797914874e-120, 6.728232153562087e-125, 1.8685438092676983e-129, 4.295446810006554e-134, 8.173652144289684e-139, 1.2874391182406464e-143, 1.6785720799076047e-148, 1.8115738116476056e-153, 1.61835881237667e-158, 1.1967304585733165e-163, 7.325219058395935e-169, 3.71148434593967e-174, 1.5566013188933827e-179, 5.403932298524003e-185, 1.5529059332277372e-190, 3.6938830684870465e-196, 7.273172403730769e-202, 1.1854066667181644e-207, 1.599239812915397e-213, 1.7859223199225568e-219, 1.6508753444190005e-225, 1.2631901844843222e-231, 8.000662448410906e-238, 4.194555040221232e-244, 1.8203235669132333e-250, 6.5390405483671176e-257, 1.9443847828266936e-263, 4.785784525390454e-270, 9.7504983488063e-277, 1.6443839512737676e-283, 2.2955269213235963e-290, 2.652554377643661e-297, 2.537166365915238e-304, 2.008798334936e-311, 1.316517e-318,
}

// std_dev = 3.2
var cdf_table_3p2 = [...]float64{
	0.5, 0.9523447998951764, 0.8225775623986646, 0.6443887248251954, 0.4578333617716143, 0.2950226561744429, 0.17242162389375287, 0.09139375535604728, 0.043936933623407434, 0.019157171837129155, 0.0075756774442599425, 0.002717064729323586, 0.0008838263069350515, 0.0002607487846688273, 6.976957719599722e-05, 1.6931612436130023e-05, 3.7266531720786777e-06, 7.439231317435057e-07, 1.3468696888087153e-07, 2.2116251758271562e-08, 3.2937141103060925e-09, 4.448859650129368e-10, 5.4500431328841584e-11, 6.055354917708228e-12, 6.101936677605367e-13, 5.5767890791115665e-14, 4.62263040548374e-15, 3.475222003601891e-16, 2.369541747340193e-17, 1.4653271804402526e-18, 8.218513554096799e-20, 4.1806169355170656e-21, 1.9287498479639315e-22, 8.070489255152528e-24, 3.0627549606146605e-25, 1.054175866903886e-26, 3.290806277274959e-28, 9.317083633057163e-30, 2.3924677935073458e-31, 5.571865648920334e-33, 1.176910943921689e-34, 2.254628518970565e-36, 3.917372050763991e-38, 6.173096616540149e-40, 8.822664357494803e-42, 1.143628238437708e-43, 1.3444925891435336e-45, 1.4335748871056266e-47, 1.3863432936412101e-49, 1.2159329201795724e-51, 9.672458544585328e-54, 6.978347093668317e-56, 4.56621846799426e-58, 2.7098748544152925e-60, 1.458579862799102e-62, 7.12032178989795e-65, 3.152517155145115e-67, 1.2659126083363215e-69, 4.610398037957091e-72, 1.5228654986099342e-74, 4.562187213172471e-77, 1.2395757965481975e-79, 3.0546503229871403e-82, 6.827132725391541e-85, 1.3838965267367769e-87, 2.544235582728249e-90, 4.242281221273962e-93, 6.4154927188958615e-96, 8.799317893789583e-99, 1.0946024821954803e-101, 1.2349582593119657e-104, 1.2636783903845782e-107, 1.1727603332849226e-110, 9.8712103619924e-114, 7.535637097807311e-117, 5.217446126023544e-120, 3.276305574229551e-123, 1.8659468007711806e-126, 9.638346694809147e-130, 4.515379530322157e-133, 1.9185556689348942e-136, 7.393379178887386e-140, 2.5840444767805284e-143, 8.191160173223455e-147, 2.3549369378030894e-150, 6.140469445038841e-154, 1.4521527347105887e-157, 3.114665762241261e-161, 6.058973183257031e-165, 1.0689934427279558e-168, 1.7105646060189028e-172, 2.482517687912519e-176, 3.2676358406799337e-180, 3.9008870886712544e-184, 4.223587911780234e-188, 4.147516535179878e-192, 3.693883068487676e-196, 2.9837785699558256e-200, 2.1859411559259695e-204, 1.4524419128072087e-208, 8.75281014057458e-213, 4.7839284226130575e-217, 2.371429769894392e-221, 1.0661646808482826e-225, 4.347371408870115e-230, 1.6077467034309273e-234, 5.39258426545879e-239, 1.6404563618600565e-243, 4.5260656967793574e-248, 1.1325710452269302e-252, 2.570386815553455e-257, 5.290782943918542e-262, 9.877108721521013e-267, 1.672353768623132e-271, 2.568117567089613e-276, 3.57676230211917e-281, 4.518077612006297e-286, 5.176136539861041e-291, 5.378314452199267e-296, 5.0684490636938594e-301, 4.332039538514894e-306, 3.35813512022e-311, 2.36098024e-316, 1.507e-321,
}

// std_dev = 6.4 original
var cdf_table_6p4o = [...]float64{
	0.5, 0.987867, 0.952345, 0.895957, 0.822578, 0.736994, 0.644389, 0.549831, 0.457833, 0.372034,
	0.295023, 0.22831, 0.172422, 0.127074, 0.0913938, 0.0641467, 0.0439369, 0.0293685, 0.0191572,
	0.0121949, 0.00757568, 0.00459264, 0.00271706, 0.00156868, 0.000883826, 0.000485955, 0.000260749,
	0.000136536, 6.97696e-05, 3.47923e-05, 1.69316e-05, 8.041e-06, 3.72665e-06, 1.68549e-06,
	7.43923e-07, 3.20426e-07, 1.34687e-07, 5.52484e-08, 2.21163e-08, 8.63973e-09,
	3.29371e-09, 1.22537e-09, 4.44886e-10, 1.57625e-10, 5.45004e-11, 1.83896e-11,
	6.05535e-12, 1.94583e-12, 6.10194e-13, 1.86736e-13, 5.57679e-14, 1.62532e-14,
	4.62263e-15, 1.28303e-15, 3.47522e-16, 9.18597e-17, 2.36954e-17, 5.96487e-18,
	1.46533e-18, 3.5129e-19, 8.21851e-20, 1.87637e-20, 4.18062e-21, 9.08991e-22, 1.92875e-22,
	3.99383e-23, 8.07049e-24, 1.5915e-24, 3.06275e-25, 5.75194e-26, 1.05418e-26, 1.88542e-27,
	3.29081e-28, 5.60522e-29, 9.31708e-30, 1.51135e-30, 2.39247e-31, 3.69594e-32,
	5.57187e-33, 8.19735e-34, 1.17691e-34, 1.64896e-35, 2.25463e-36, 3.00841e-37,
	3.91737e-38, 4.97795e-39, 6.1731e-40, 7.47055e-41, 8.82266e-42, 1.01682e-42, 1.14363e-43,
	1.25523e-44, 1.34449e-45, 1.40537e-46, 1.43357e-47, 1.42708e-48, 1.38634e-49,
	1.31429e-50, 1.21593e-51, 1.0978e-52, 9.67246e-54, 8.31661e-55, 6.97835e-56, 5.71421e-57,
	4.56622e-58, 3.56086e-59, 2.70987e-60, 2.01252e-61, 1.45858e-62, 1.03161e-63,
	7.12032e-65, 4.79601e-66, 3.15252e-67, 2.02224e-68, 1.26591e-69, 7.73344e-71, 4.6104e-72,
	2.68226e-73, 1.52287e-74, 8.4376e-76, 4.56219e-77, 2.40727e-78, 1.23958e-79, 6.22901e-81,
	3.05465e-82, 1.46185e-83, 6.82713e-85, 3.11152e-86, 1.3839e-87,
}

// std_dev = 6.4
var cdf_table_6p4 = [...]float64{
	0.5, 0.9878671723140003, 0.9523447998951764, 0.8959566209925682, 0.8225775623986646, 0.736993813311011, 0.6443887248251954, 0.5498308842335518, 0.4578333617716143, 0.3720341859374525, 0.2950226561744429, 0.22831003268047267, 0.17242162389375287, 0.12707367009073386, 0.09139375535604728, 0.06414673848332596, 0.043936933623407434, 0.029368516926505713, 0.019157171837129155, 0.012194889831651208, 0.0075756774442599425, 0.0045926375916388726, 0.002717064729323586, 0.0015686819551156451, 0.0008838263069350515, 0.00048595499985097386, 0.0002607487846688273, 0.00013653551674503917, 6.976957719599722e-05, 3.479234101263891e-05, 1.6931612436130023e-05, 8.041000588185211e-06, 3.7266531720786777e-06, 1.6854852873722956e-06, 7.439231317435057e-07, 3.2042638298308737e-07, 1.3468696888087153e-07, 5.524843729234549e-08, 2.2116251758271562e-08, 8.639729769913123e-09, 3.2937141103060925e-09, 1.2253742477384276e-09, 4.448859650129368e-10, 1.5762524280470742e-10, 5.4500431328841584e-11, 1.838955489497277e-11, 6.055354917708228e-12, 1.94583090172743e-12, 6.101936677605367e-13, 1.867357215750939e-13, 5.5767890791115665e-14, 1.6253172389003213e-14, 4.62263040548374e-15, 1.2830314698448336e-15, 3.475222003601891e-16, 9.185967516020678e-17, 2.369541747340193e-17, 5.9648692909415595e-18, 1.4653271804402526e-18, 3.512896762713697e-19, 8.218513554096799e-20, 1.8763690981207474e-20, 4.1806169355170656e-21, 9.089910067890163e-22, 1.9287498479639315e-22, 3.993827752956329e-23, 8.070489255152528e-24, 1.5915031557361074e-24, 3.0627549606146605e-25, 5.75193682139395e-26, 1.054175866903886e-26, 1.8854244719142572e-27, 3.290806277274959e-28, 5.605219210529805e-29, 9.317083633057163e-30, 1.511348061581414e-30, 2.3924677935073458e-31, 3.6959391672236534e-32, 5.571865648920334e-33, 8.197351633240025e-34, 1.176910943921689e-34, 1.648962370190244e-35, 2.254628518970565e-36, 3.0084053656654662e-37, 3.917372050763991e-38, 4.977948436014447e-39, 6.173096616540149e-40, 7.470554909847627e-41, 8.822664357494803e-42, 1.0168192518736734e-42, 1.143628238437708e-43, 1.2552293570253407e-44, 1.3444925891435336e-45, 1.4053705384872047e-46, 1.4335748871056266e-47, 1.427075767105878e-48, 1.3863432936412101e-49, 1.3142913439783726e-50, 1.2159329201795724e-51, 1.0978037076136135e-52, 9.672458544585328e-54, 8.316606785993381e-55, 6.978347093668317e-56, 5.714208368249234e-57, 4.56621846799426e-58, 3.5608559643911393e-59, 2.7098748544152925e-60, 2.0125244743147372e-61, 1.458579862799102e-62, 1.0316119484213045e-63, 7.12032178989795e-65, 4.796008964652135e-66, 3.152517155145115e-67, 2.022236935152923e-68, 1.2659126083363215e-69, 7.733436429585977e-71, 4.610398037957091e-72, 2.6822634455645844e-73, 1.5228654986099342e-74, 8.437596863890068e-76, 4.562187213172471e-77, 2.407268548287382e-78, 1.2395757965481975e-79, 6.229005886381123e-81, 3.0546503229871403e-82, 1.4618451472085412e-83, 6.827132725391541e-85, 3.111518797284251e-86, 1.3838965267367769e-87,
}

// std_dev = 12.8
var cdf_table_12p8 = [...]float64{
	0.5, 0.9969528940670334, 0.9878671723140003, 0.9729079356743677, 0.9523447998951764, 0.9265438133162349, 0.8959566209925682, 0.8611073232281194, 0.8225775623986646, 0.7809904299423261, 0.736993813311011, 0.6912438000911793, 0.6443887248251954, 0.5970543863575225, 0.5498308842335518, 0.5032614272512166, 0.4578333617716143, 0.4139715580775787, 0.3720341859374525, 0.3323108109944679, 0.2950226561744429, 0.26032480039684014, 0.22831003268047267, 0.1990140442131382, 0.17242162389375287, 0.1484735230177951, 0.12707367009073386, 0.10809644454401726, 0.09139375535604728, 0.07680171408115745, 0.06414673848332596, 0.05325097004172588, 0.043936933623407434, 0.036031408671175984, 0.029368516926505713, 0.023792061120580653, 0.019157171837129155, 0.015331335926454075, 0.012194889831651208, 0.009641065640850429, 0.0075756774442599425, 0.005916531584296955, 0.0045926375916388726, 0.003543287908034098, 0.002717064729323586, 0.00207082216311244, 0.0015686819551156451, 0.0011810717289783316, 0.0008838263069350515, 0.0006573654143868984, 0.00048595499985097386, 0.0003570545201590211, 0.0002607487846688273, 0.00018926021416137907, 0.00013653551674503917, 9.789966964829633e-05, 6.976957719599722e-05, 4.9419714580126844e-05, 3.479234101263891e-05, 2.4345368172635518e-05, 1.6931612436130023e-05, 1.1703872122021586e-05, 8.041000588185211e-06, 5.490854006436884e-06, 3.7266531720786777e-06, 2.5138961487641353e-06, 1.6854852873722956e-06, 1.1231865029937042e-06, 7.439231317435057e-07, 4.897264116659102e-07, 3.2042638298308737e-07, 2.0837820130283442e-07, 1.3468696888087153e-07, 8.65263034754153e-08, 5.524843729234549e-08, 3.50623582899683e-08, 2.2116251758271562e-08, 1.3865361708823024e-08, 8.639729769913123e-09, 5.3507959692150935e-09, 3.2937141103060925e-09, 2.015128226056274e-09, 1.2253742477384276e-09, 7.40600649607606e-10, 4.448859650129368e-10, 2.656211168398732e-10, 1.5762524280470742e-10, 9.29690119803611e-11, 5.4500431328841584e-11, 3.175491393965628e-11, 1.838955489497277e-11, 1.058475407127629e-11, 6.055354917708228e-12, 3.443084737609772e-12, 1.94583090172743e-12, 1.092978849476011e-12, 6.101936677605367e-13, 3.385890523583385e-13, 1.867357215750939e-13, 1.023602112002819e-13, 5.5767890791115665e-14, 3.019858139488412e-14, 1.6253172389003213e-14, 8.694388017806123e-15, 4.62263040548374e-15, 2.442803883398828e-15, 1.2830314698448336e-15, 6.697848079161992e-16, 3.475222003601891e-16, 1.7921695366659984e-16, 9.185967516020678e-17, 4.6797213758677716e-17, 2.369541747340193e-17, 1.192498961697767e-17, 5.9648692909415595e-18, 2.965467235212773e-18, 1.4653271804402526e-18, 7.196566746794809e-19, 3.512896762713697e-19, 1.7043339411747601e-19, 8.218513554096799e-20, 3.9389560531359056e-20, 1.8763690981207474e-20, 8.883920946346785e-21, 4.1806169355170656e-21, 1.9553537679939142e-21, 9.089910067890163e-22, 4.1999402040478614e-22, 1.9287498479639315e-22,
}

// The function below is modeled on Martin Albrecht's discrete-Gaussian
// sampler included in his dgs library:
// https://github.com/malb/dgs
func GaussSample() int64 {
	mrand := MathRand()

	// fmt.Println("len(cdf_table_1):", len(cdf_table_1))
	// fmt.Println("len(cdf_table_1p4):", len(cdf_table_1p4))
	// fmt.Println("len(cdf_table_2p3):", len(cdf_table_2p3))
	// fmt.Println("len(cdf_table_3p2):", len(cdf_table_3p2))
	// fmt.Println("len(cdf_table_6p4o):", len(cdf_table_6p4o))
	// fmt.Println("len(cdf_table_6p4):", len(cdf_table_6p4))
	// fmt.Println("len(cdf_table_12p8):", len(cdf_table_12p8))

	cdf_table := cdf_table_12p8
	
	var x int64
	var y float64
	for {
		x = int64(mrand.Intn(len(cdf_table)))
		y = mrand.Float64()

		if y < cdf_table[x] {
			break
		}
	}

	if mrand.Uint64()%2 == 0 {
		x = -x
	}

	return x
}
